---
title: Transparent proxy for Azure Stack Hub integrated systems 
description: Overview of transparent property in Azure Stack Hub integrated systems.
author: PatAltimore
ms.topic: conceptual
ms.date: 01/12/2021
ms.author: patricka
ms.reviewer: sranthar
ms.lastreviewed: 01/12/2021

# Intent: As an Azure Stack operator, I want to know how to transparent proxy works in Azure Stack.
# Keyword: azure stack transparent proxy
---

# Transparent proxy for Azure Stack Hub

A transparent proxy (also known as an intercepting, inline, or forced proxy) intercepts normal communication at the network layer without requiring special client configuration. Clients don't need to be aware of the existence of the proxy.

If your datacenter requires all traffic to use a proxy, you configure a transparent proxy to process all traffic according to policy by separating traffic between the zones on your network.

## Traffic types

Outbound traffic from Azure Stack Hub is categorized as either tenant traffic or infrastructure traffic.

Tenant traffic is generated by tenants by way of virtual machines, load balancers, VPN gateways, app services, etc.

Infrastructure traffic is generated from the `/27` subnet range of the public virtual IP pool assigned to infrastructure services such as identity, patch and update, usage metrics, Marketplace syndication, registration, log collection, Windows Defender, etc. The traffic from these services is routed to [Azure endpoints](azure-stack-integrate-endpoints.md#ports-and-urls-outbound). Azure does not accept traffic modified by a proxy or TLS/SSL intercepted traffic. This reason is why Azure Stack Hub does not support a native proxy configuration.

When configuring a transparent proxy, you can choose to send all outbound traffic or only infrastructure traffic through the proxy.

## Partner integration

Microsoft has partnered with Citrix ADC, Cisco WSA, Check Point Security Gateway, and Sophos XG Firewall to validate Azure Stack Hub’s use case scenarios with a transparent proxy configuration. The following diagram is an example Azure Stack Hub network configuration.

![Network diagram with proxy before border devices](./media/azure-stack-transparent-proxy/proxy.svg)

External proxy devices must be placed before the border devices. Additionally, the border devices must be configured to route traffic to Azure Stack Hub one of the following ways:
- Route all traffic to Azure Stack Hub
- Route traffic from the `/27` subnet range of the Azure Stack Hub virtual IP pool to the proxy devices via a policy-based routing rule or a default route.  

For a sample border configuration, see [need link]().

The Sophos and Check Point devices provide a dual-mode feature that allows specific ranges of traffic through transparent mode, while other ranges can be configured to be through an explicit mode. Using this feature, only infrastructure traffic is sent through the transparent proxy, while all tenant traffic is sent through the explicit mode.

For more information on how to configure a transparent proxy with Azure Stack Hub, see the following articles: 

- [Configure a Citrix ADC transparent proxy]()
- [Configure Cisco WSA transparent proxy]()
- [Configure a Check Point Security Gateway transparent proxy]()
- [Configure a Sophos XG firewall transparent proxy](https://community.sophos.com/xg-firewall/f/recommended-reads/124106/xg-firewall-integration-with-azure-stack-hub)

> [!IMPORTANT]
> SSL traffic interception is not supported and can lead to service failures when accessing endpoints. The maximum supported timeout to communicate with endpoints required for identity is 60s with 3 retry attempts. For more information, see [Azure Stack Hub firewall integration](azure-stack-firewall.md#ssl-interception).
